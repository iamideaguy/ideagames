<!doctype html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E4PJR6D8CJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E4PJR6D8CJ');
</script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Death Queue ‚Äî V1</title>
  <style>
    :root{
      --bg:#89c9ff;         /* baby blue */
      --bg2:#6bb7ff;
      --white:#ffffff;
      --ink:rgba(255,255,255,.92);
      --ink2:rgba(255,255,255,.75);
      --line:rgba(255,255,255,.35);
      --shadow: rgba(0,0,0,.14);
      --good:#35ff9b;
      --bad:#ff4d6d;
      --chaos:#ffd166;

      /* ‚Äúarcade-ish‚Äù without external fonts */
      --arcade: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --ui: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      background:
        radial-gradient(900px 520px at 65% 15%, rgba(255,255,255,.25), transparent 60%),
        radial-gradient(700px 420px at 15% 25%, rgba(255,255,255,.20), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--white);
      font-family: var(--ui);
    }

    .app{ width:min(980px, 100%); display:grid; gap:14px; }

    /* HEADER */
    .hud{
      display:grid;
      gap:10px;
      padding:14px 14px;
      border:1px solid var(--line);
      border-radius:18px;
      background: rgba(255,255,255,.10);
      box-shadow: 0 18px 60px var(--shadow);
      backdrop-filter: blur(6px);
    }
    .topRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 260px;
    }
    .title{
      margin:0;
      font-family: var(--arcade);
      letter-spacing: .14em;
      text-transform: uppercase;
      font-size: clamp(16px, 2.6vw, 22px);
      text-shadow: 0 2px 0 rgba(0,0,0,.10);
    }
    .sub{
      margin:0;
      color:var(--ink2);
      font-size: 13px;
      line-height:1.35;
      max-width: 70ch;
    }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      width: min(420px, 100%);
    }
    .stat{
      border:1px solid var(--line);
      border-radius:16px;
      padding:10px 12px;
      background: rgba(255,255,255,.08);
    }
    .label{
      font-family: var(--arcade);
      letter-spacing:.10em;
      text-transform: uppercase;
      font-size: 11px;
      color: var(--ink2);
    }
    .value{
      margin-top:6px;
      font-family: var(--arcade);
      font-size: 18px;
      letter-spacing:.06em;
      text-shadow: 0 2px 0 rgba(0,0,0,.08);
    }
    .bigValue{
      font-size: 22px;
    }

    .queueLine{
      margin-top:4px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .queueNumber{
      font-family: var(--arcade);
      letter-spacing:.08em;
      font-size: clamp(18px, 3vw, 26px);
      text-shadow: 0 2px 0 rgba(0,0,0,.10);
    }
    .pillRow{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .pill{
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      background: rgba(255,255,255,.08);
      color: var(--ink);
      font-size:12px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      user-select:none;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.95);
      box-shadow: 0 0 14px rgba(255,255,255,.65);
    }

    /* STAGE */
    .stage{
      border:1px solid var(--line);
      border-radius:18px;
      overflow:hidden;
      background: rgba(255,255,255,.10);
      box-shadow: 0 18px 60px var(--shadow);
      position:relative;
    }
    .stageInner{
      padding:14px;
      display:grid;
      gap:12px;
    }

    .beltWrap{
      position:relative;
      height: 240px;
      border:1px solid rgba(255,255,255,.28);
      border-radius:16px;
      overflow:hidden;
      background:
        radial-gradient(600px 200px at 50% 20%, rgba(255,255,255,.16), transparent 60%),
        rgba(255,255,255,.06);
    }

    .belt{
      position:absolute;
      left:0; right:0;
      bottom:32px;
      height:74px;
      background:
        repeating-linear-gradient(90deg,
          rgba(255,255,255,.12) 0px,
          rgba(255,255,255,.12) 26px,
          rgba(255,255,255,.05) 26px,
          rgba(255,255,255,.05) 52px);
      border-top: 1px solid rgba(255,255,255,.25);
      border-bottom: 1px solid rgba(255,255,255,.25);
      transform: translateX(0);
    }

    .lane{
      position:absolute;
      left:0; right:0;
      top:34px;
      height: 170px;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      gap:18px;
      pointer-events:none;
    }

    .person{
      width: 72px;
      height: 140px;
      position:relative;
      transform: translateY(0);
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.12));
    }

    .head{
      position:absolute;
      top:6px; left:50%;
      width: 34px; height: 34px;
      transform: translateX(-50%);
      border-radius: 999px;
      background: rgba(255,255,255,.85);
      outline: 3px solid rgba(255,255,255,.18);
    }
    .body{
      position:absolute;
      top:42px; left:50%;
      width: 56px; height: 72px;
      transform: translateX(-50%);
      border-radius: 18px;
      background: rgba(255,255,255,.22);
      border: 1px solid rgba(255,255,255,.25);
    }
    .tie{
      position:absolute;
      top:54px; left:50%;
      width: 10px; height: 30px;
      transform: translateX(-50%);
      background: rgba(255,255,255,.60);
      border-radius: 6px;
      opacity:.9;
    }
    .legs{
      position:absolute;
      bottom:8px; left:50%;
      width: 56px; height: 40px;
      transform: translateX(-50%);
      display:flex; gap:8px;
      justify-content:center;
    }
    .leg{
      width: 14px; height: 40px;
      border-radius: 10px;
      background: rgba(255,255,255,.20);
      border: 1px solid rgba(255,255,255,.20);
    }

    .bubble{
      position:absolute;
      top:0px; left:50%;
      transform: translate(-50%, -18px);
      font-size: 18px;
      opacity:0;
      transition: opacity .18s ease, transform .18s ease;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,.12));
      pointer-events:none;
    }
    .bubble.show{
      opacity:1;
      transform: translate(-50%, -26px);
    }

    .player .body{
      background: rgba(255,255,255,.30);
      border-color: rgba(255,255,255,.40);
    }
    .playerGlow{
      position:absolute; inset:-12px -10px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.0);
      box-shadow: 0 0 0 rgba(0,0,0,0);
      transition: box-shadow .2s ease, border-color .2s ease;
      pointer-events:none;
    }
    .player.good .playerGlow{
      border-color: rgba(53,255,155,.35);
      box-shadow: 0 0 26px rgba(53,255,155,.25);
    }
    .player.bad .playerGlow{
      border-color: rgba(255,77,109,.35);
      box-shadow: 0 0 26px rgba(255,77,109,.25);
    }
    .player.chaos .playerGlow{
      border-color: rgba(255,209,102,.45);
      box-shadow: 0 0 28px rgba(255,209,102,.28);
    }

    .face{
      position:absolute;
      top:16px; left:50%;
      transform: translateX(-50%);
      font-size: 14px;
      opacity:.95;
    }

    .statusBar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .statusText{
      font-family: var(--arcade);
      letter-spacing:.08em;
      font-size: 12px;
      text-transform: uppercase;
      color: var(--ink);
    }
    .mini{
      color: var(--ink2);
      font-size: 12px;
    }

    .actions{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 760px){
      .actions{ grid-template-columns: 1fr 1fr; }
      .beltWrap{ height: 260px; }
      .stats{ grid-template-columns: 1fr; }
    }
    .btn{
      border:1px solid rgba(255,255,255,.35);
      background: rgba(255,255,255,.10);
      color: var(--white);
      border-radius: 16px;
      padding: 12px 12px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 10px 30px rgba(0,0,0,.10);
      transition: transform .08s ease, background .12s ease, opacity .12s ease;
      font-family: var(--arcade);
      letter-spacing:.08em;
      text-transform: uppercase;
      font-size: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .btn:active{ transform: translateY(1px); }
    .btn small{
      font-family: var(--ui);
      letter-spacing:0;
      text-transform:none;
      opacity:.9;
      font-size: 12px;
      color: var(--ink2);
    }
    .btn.good{ border-color: rgba(53,255,155,.55); }
    .btn.bad{ border-color: rgba(255,77,109,.55); }
    .btn.chaos{ border-color: rgba(255,209,102,.75); }

    .btn[disabled]{ opacity:.55; cursor:not-allowed; transform:none; }

    .cd{
      position:relative;
      width: 54px;
      height: 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.35);
      overflow:hidden;
      flex: 0 0 auto;
      background: rgba(255,255,255,.08);
    }
    .cdFill{
      height:100%;
      width:100%;
      background: rgba(255,255,255,.65);
      transform-origin: left center;
      transform: scaleX(0);
      transition: transform .1s linear;
    }

    .toast{
      position:absolute;
      left:14px;
      top:14px;
      max-width: min(520px, calc(100% - 28px));
      border:1px solid rgba(255,255,255,.35);
      border-radius: 14px;
      background: rgba(255,255,255,.12);
      padding:10px 12px;
      color: var(--white);
      box-shadow: 0 18px 60px rgba(0,0,0,.12);
      backdrop-filter: blur(8px);
      opacity:0;
      transform: translateY(-6px);
      transition: opacity .18s ease, transform .18s ease;
      pointer-events:none;
      font-size: 13px;
      line-height:1.35;
    }
    .toast.show{
      opacity:1;
      transform: translateY(0);
    }

    .slot{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.08);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease;
    }
    .slot.show{ opacity:1; }
    .slotBox{
      border:1px solid rgba(255,255,255,.45);
      border-radius:18px;
      background: rgba(255,255,255,.14);
      padding:14px 16px;
      width:min(440px, calc(100% - 34px));
      box-shadow: 0 18px 60px rgba(0,0,0,.14);
      text-align:center;
    }
    .slotTitle{
      font-family: var(--arcade);
      letter-spacing:.12em;
      text-transform: uppercase;
      margin-bottom:10px;
    }
    .reels{
      display:flex;
      justify-content:center;
      gap:10px;
      margin: 10px 0 12px;
    }
    .reel{
      width: 90px;
      height: 70px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.45);
      background: rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 30px;
      font-weight: 800;
      filter: drop-shadow(0 10px 24px rgba(0,0,0,.12));
    }
    .slotSub{
      color: var(--ink2);
      font-size: 12px;
    }

    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      background: rgba(0,0,0,.22);
      z-index:50;
    }
    .modal.show{ display:flex; }
    .card{
      width:min(640px, 100%);
      border:1px solid rgba(255,255,255,.45);
      border-radius: 20px;
      background: rgba(255,255,255,.14);
      box-shadow: 0 30px 90px rgba(0,0,0,.20);
      overflow:hidden;
    }
    .cardHead{
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.25);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .cardHead h2{
      margin:0;
      font-family: var(--arcade);
      letter-spacing:.12em;
      text-transform: uppercase;
      font-size: 16px;
    }
    .cardBody{
      padding:16px;
      display:grid;
      gap:12px;
    }
    pre{
      margin:0;
      white-space:pre-wrap;
      font-family: var(--arcade);
      letter-spacing:.06em;
      font-size: 12px;
      color: rgba(255,255,255,.92);
      line-height:1.5;
    }
    .rowBtns{ display:flex; gap:10px; flex-wrap:wrap; }
    .btn2{
      border:1px solid rgba(255,255,255,.45);
      background: rgba(255,255,255,.10);
      color: var(--white);
      border-radius: 14px;
      padding:10px 12px;
      cursor:pointer;
      font-family: var(--arcade);
      letter-spacing:.08em;
      text-transform: uppercase;
      font-size: 12px;
    }

    .shake{
      animation: shake .22s ease-in-out 1;
    }
    @keyframes shake{
      0%{ transform: translateX(0); }
      25%{ transform: translateX(-5px); }
      50%{ transform: translateX(5px); }
      75%{ transform: translateX(-3px); }
      100%{ transform: translateX(0); }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="hud">
      <div class="topRow">
        <div class="brand">
          <h1 class="title">DEATH QUEUE</h1>
          <p class="sub">You‚Äôre in line. The timer never stops. Buttons bend the queue‚Ä¶ slightly. (90 seconds)</p>
        </div>
        <div class="stats">
          <div class="stat">
            <div class="label">Time Remaining</div>
            <div class="value bigValue" id="time">01:30</div>
          </div>
          <div class="stat">
            <div class="label">Queue Movement</div>
            <div class="value" id="move">0</div>
          </div>
        </div>
      </div>

      <div class="queueLine">
        <div class="queueNumber" id="queueNum">#4,382,110,991</div>
        <div class="pillRow">
          <span class="pill"><span class="dot"></span>Live Processing</span>
          <span class="pill" id="statusPill">STATUS: CORPORATE NEUTRAL üòê</span>
        </div>
      </div>
    </div>

    <div class="stage" id="stage">
      <div class="toast" id="toast">Welcome. Your number has been assigned.</div>

      <div class="stageInner">
        <div class="beltWrap" id="beltWrap">
          <div class="belt" id="belt"></div>
          <div class="lane" id="lane"></div>

          <div class="slot" id="slot">
            <div class="slotBox">
              <div class="slotTitle">TAKE A RISK</div>
              <div class="reels">
                <div class="reel" id="r1">?</div>
                <div class="reel" id="r2">?</div>
                <div class="reel" id="r3">?</div>
              </div>
              <div class="slotSub" id="slotSub">FINALIZING OUTCOME‚Ä¶</div>
            </div>
          </div>
        </div>

        <div class="statusBar">
          <div class="statusText" id="statusText">STATUS: CORPORATE NEUTRAL</div>
          <div class="mini" id="hint">Tip: Doomscroll is tempting. It‚Äôs also a trap.</div>
        </div>

        <div class="actions">
          <button class="btn good" id="btnLaugh">
            LAUGH <small>+back</small>
            <span class="cd"><span class="cdFill" id="cdLaugh"></span></span>
          </button>

          <button class="btn good" id="btnWater">
            DRINK WATER <small>slow 3s</small>
            <span class="cd"><span class="cdFill" id="cdWater"></span></span>
          </button>

          <button class="btn bad" id="btnDoom">
            DOOMSCROLL <small>-forward</small>
            <span class="cd"><span class="cdFill" id="cdDoom"></span></span>
          </button>

          <button class="btn bad" id="btnSmoke">
            SMOKE <small>delay hit</small>
            <span class="cd"><span class="cdFill" id="cdSmoke"></span></span>
          </button>

          <button class="btn chaos" id="btnRisk">
            TAKE A RISK <small>??</small>
            <span class="cd"><span class="cdFill" id="cdRisk"></span></span>
          </button>

          <button class="btn chaos" id="btnIgnore">
            IGNORE EVERYTHING <small>freeze‚Üíspeed</small>
            <span class="cd"><span class="cdFill" id="cdIgnore"></span></span>
          </button>
        </div>

        <div class="mini">V1: 6 actions ‚Ä¢ cooldowns ‚Ä¢ simple physics ‚Ä¢ end receipt</div>
      </div>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="card">
      <div class="cardHead">
        <h2>SESSION COMPLETE</h2>
        <button class="btn2" id="close">CLOSE</button>
      </div>
      <div class="cardBody">
        <pre id="summary"></pre>
        <div class="rowBtns">
          <button class="btn2" id="retry">RETRY</button>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
  const fmtTime = (s) => {
    s = Math.max(0, Math.floor(s));
    const m = Math.floor(s/60);
    const r = s % 60;
    return `${String(m).padStart(2,'0')}:${String(r).padStart(2,'0')}`;
  };
  const commas = (n) => n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

  const timeEl = $("time");
  const queueEl = $("queueNum");
  const moveEl = $("move");
  const statusPill = $("statusPill");
  const statusText = $("statusText");
  const hintEl = $("hint");
  const toast = $("toast");
  const stage = $("stage");
  const belt = $("belt");
  const lane = $("lane");

  const slot = $("slot");
  const r1 = $("r1"), r2 = $("r2"), r3 = $("r3"), slotSub = $("slotSub");

  const modal = $("modal");
  const summary = $("summary");
  const close = $("close");
  const retry = $("retry");

  const actions = {
    laugh: { btn: $("btnLaugh"), cd: $("cdLaugh"), cooldown: 5,  last: -999 },
    water: { btn: $("btnWater"), cd: $("cdWater"), cooldown: 8,  last: -999 },
    doom:  { btn: $("btnDoom"),  cd: $("cdDoom"),  cooldown: 4,  last: -999 },
    smoke: { btn: $("btnSmoke"), cd: $("cdSmoke"), cooldown: 10, last: -999 },
    risk:  { btn: $("btnRisk"),  cd: $("cdRisk"),  cooldown: 15, last: -999 },
    ignore:{ btn: $("btnIgnore"),cd: $("cdIgnore"),cooldown: 20, last: -999 },
  };

  const state = {
    duration: 90,
    timeLeft: 90,
    running: true,

    pos: 0,
    vel: 0,

    queueStart: 4382110991,
    queueNow: 4382110991,

    netMoveUnits: 0,
    best: "‚Äî",
    worst: "‚Äî",

    slowTimerUntil: 0,
    freezeUntil: 0,
    speedAfterIgnoreUntil: 0,
    pendingSmokeAt: 0,
    pendingSmoke: false,

    status: "CORPORATE NEUTRAL",
    face: "üòê",
    startedAt: performance.now(),
    lastTick: performance.now(),
    beltPhase: 0
  };

  function makePerson(isPlayer=false){
    const p = document.createElement("div");
    p.className = "person" + (isPlayer ? " player" : "");
    if(isPlayer){
      const glow = document.createElement("div");
      glow.className = "playerGlow";
      p.appendChild(glow);
    }
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.textContent = "‚Ä¶";
    bubble.dataset.role = "bubble";

    const head = document.createElement("div");
    head.className = "head";

    const face = document.createElement("div");
    face.className = "face";
    face.textContent = isPlayer ? state.face : (Math.random() < 0.35 ? "üòÆ‚Äçüí®" : "üò∂");

    const body = document.createElement("div");
    body.className = "body";

    const tie = document.createElement("div");
    tie.className = "tie";

    const legs = document.createElement("div");
    legs.className = "legs";
    const leg1 = document.createElement("div"); leg1.className = "leg";
    const leg2 = document.createElement("div"); leg2.className = "leg";
    legs.appendChild(leg1); legs.appendChild(leg2);

    p.appendChild(bubble);
    p.appendChild(head);
    p.appendChild(face);
    p.appendChild(body);
    p.appendChild(tie);
    p.appendChild(legs);
    return p;
  }

  const npcCount = 6;
  const people = [];
  for(let i=0;i<Math.floor(npcCount/2);i++) people.push(makePerson(false));
  const player = makePerson(true);
  people.push(player);
  for(let i=0;i<Math.ceil(npcCount/2);i++) people.push(makePerson(false));
  people.forEach(p => lane.appendChild(p));

  function setPlayerFace(emoji){
    state.face = emoji;
    const face = player.querySelector(".face");
    if(face) face.textContent = emoji;
  }

  function popBubble(text, ms=900){
    const b = player.querySelector('[data-role="bubble"]');
    if(!b) return;
    b.textContent = text;
    b.classList.add("show");
    setTimeout(() => b.classList.remove("show"), ms);
  }

  let toastTimer = null;
  function showToast(msg, ms=1400){
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => toast.classList.remove("show"), ms);
  }

  function setStatus(label, faceEmoji){
    state.status = label;
    statusText.textContent = `STATUS: ${label}`;
    statusPill.textContent = `STATUS: ${label} ${faceEmoji}`;
    setPlayerFace(faceEmoji);
  }

  function nudge(dx, kind){
    state.vel += dx * 6;
    const units = Math.round(dx / 8);
    state.netMoveUnits += units;

    player.classList.remove("good","bad","chaos");
    if(kind) player.classList.add(kind);
    setTimeout(() => player.classList.remove("good","bad","chaos"), 450);

    const sign = state.netMoveUnits >= 0 ? "+" : "";
    moveEl.textContent = `${sign}${state.netMoveUnits}`;
  }

  function canUse(key, nowS){
    return (nowS - actions[key].last) >= actions[key].cooldown;
  }
  function startCooldown(key, nowS){
    actions[key].last = nowS;
  }
  function updateCooldownUI(nowS){
    for(const [k, a] of Object.entries(actions)){
      const t = nowS - a.last;
      const left = a.cooldown - t;
      const pct = clamp(1 - (left / a.cooldown), 0, 1);
      a.cd.style.transform = `scaleX(${pct})`;

      const ready = left <= 0;
      a.btn.disabled = !ready || !state.running;

      const small = a.btn.querySelector("small");
      if(small){
        if(!ready){
          small.textContent = `CD ${Math.ceil(left)}s`;
        } else {
          if(k === "laugh") small.textContent = "+back";
          if(k === "water") small.textContent = "slow 3s";
          if(k === "doom")  small.textContent = "-forward";
          if(k === "smoke") small.textContent = "delay hit";
          if(k === "risk")  small.textContent = "??";
          if(k === "ignore")small.textContent = "freeze‚Üíspeed";
        }
      }
    }
  }

  function actLaugh(now){
    setStatus("MOMENTARY JOY", "üòÇ");
    popBubble("haha");
    showToast("LAUGHTER PROCESSED  ‚Ä¢  +12 minutes*", 1400);
    hintEl.textContent = "*not legally binding.";
    nudge(+16, "good");
    state.slowTimerUntil = Math.max(state.slowTimerUntil, now + 900);
    state.best = "LAUGH";
  }

  function actWater(now){
    setStatus("HYDRATED", "üòå");
    popBubble("glug");
    showToast("HYDRATION REGISTERED  ‚Ä¢  timer slowed (3s)", 1400);
    hintEl.textContent = "Hydration feels good. Bureaucracy feels better.";
    state.slowTimerUntil = Math.max(state.slowTimerUntil, now + 3000);
    nudge(+8, "good");
    if(state.best === "‚Äî") state.best = "DRINK WATER";
  }

  function actDoom(now){
    setStatus("ATTENTION DRAINED", "üòµ‚Äçüí´");
    popBubble("‚Ä¶");
    showToast("ATTENTION DRAINED  ‚Ä¢  -1 hour*", 1400);
    hintEl.textContent = "*also not legally binding.";
    nudge(-18, "bad");
    state.speedAfterIgnoreUntil = Math.max(state.speedAfterIgnoreUntil, now + 550);
    state.worst = "DOOMSCROLL";
    stage.classList.add("shake");
    setTimeout(()=>stage.classList.remove("shake"), 240);
  }

  function actSmoke(now){
    setStatus("RELIEF REGISTERED", "üòå");
    popBubble("üö¨");
    showToast("RELIEF REGISTERED  ‚Ä¢  side effects pending‚Ä¶", 1400);
    hintEl.textContent = "Short-term calm. Long-term paperwork.";
    state.pendingSmoke = true;
    state.pendingSmokeAt = now + 1400;
    if(state.worst === "‚Äî") state.worst = "SMOKE";
  }

  function resolveSmokePenalty(){
    setStatus("SIDE EFFECT DETECTED", "üòµ");
    popBubble("cough");
    showToast("SIDE EFFECT DETECTED  ‚Ä¢  filtered air fee applied", 1500);
    nudge(-26, "bad");
    stage.classList.add("shake");
    setTimeout(()=>stage.classList.remove("shake"), 240);
    state.worst = "SMOKE";
  }

  function actIgnore(now){
    setStatus("AVOIDANCE MODE", "üòê");
    popBubble("üôà");
    showToast("IGNORING‚Ä¶ actions frozen (3s)", 1400);
    hintEl.textContent = "Ignoring is a premium feature.";
    state.freezeUntil = Math.max(state.freezeUntil, now + 3000);
    state.speedAfterIgnoreUntil = Math.max(state.speedAfterIgnoreUntil, now + 6000);
    nudge(+4, "chaos");
    if(state.best === "‚Äî") state.best = "IGNORE EVERYTHING";
  }

  function actRisk(now){
    setStatus("RISK ASSESSMENT", "üò¨");
    popBubble("üé∞");
    hintEl.textContent = "Outcome finalizing‚Ä¶";
    showToast("FINALIZING OUTCOME‚Ä¶", 1000);

    slot.classList.add("show");
    slotSub.textContent = "FINALIZING OUTCOME‚Ä¶";

    const icons = ["üçÄ","üíº","üìâ","üö≤","üéâ","‚ö†Ô∏è","üßæ","‚òï"];
    let spins = 0;

    const spinTimer = setInterval(() => {
      r1.textContent = icons[Math.floor(Math.random()*icons.length)];
      r2.textContent = icons[Math.floor(Math.random()*icons.length)];
      r3.textContent = icons[Math.floor(Math.random()*icons.length)];
      spins++;
      if(spins >= 12){
        clearInterval(spinTimer);

        const roll = Math.random();
        const win = roll < 0.45;

        if(win){
          slotSub.textContent = "WIN: TIME TEMPORARILY UNSTABLE";
          setTimeout(() => {
            slot.classList.remove("show");
            setStatus("LUCKY BREAK", "üòÆ‚Äçüí®");
            showToast("LUCKY BREAK  ‚Ä¢  big step back", 1400);
            nudge(+42, "chaos");
            state.best = "TAKE A RISK";
          }, 520);
        } else {
          slotSub.textContent = "LOSS: FORM 27-B REQUIRED";
          setTimeout(() => {
            slot.classList.remove("show");
            setStatus("FORM 27-B REQUIRED", "üòµ");
            showToast("LOSS  ‚Ä¢  sudden pull forward", 1400);
            nudge(-46, "chaos");
            state.worst = "TAKE A RISK";
            stage.classList.add("shake");
            setTimeout(()=>stage.classList.remove("shake"), 240);
          }, 520);
        }
      }
    }, 90);
  }

  function bind(key, fn){
    actions[key].btn.addEventListener("click", () => {
      const now = performance.now();
      const nowS = (now - state.startedAt) / 1000;
      if(!canUse(key, nowS) || !state.running) return;
      startCooldown(key, nowS);
      fn(now);
    });
  }

  bind("laugh", actLaugh);
  bind("water", actWater);
  bind("doom", actDoom);
  bind("smoke", actSmoke);
  bind("risk", actRisk);
  bind("ignore", actIgnore);

  function endSession(){
    state.running = false;

    const start = state.queueStart;
    const end = state.queueNow;

    const title =
      state.netMoveUnits >= 12 ? "TIME AUDITOR (UNPAID)" :
      state.netMoveUnits >= 3  ? "CORPORATE SURVIVOR" :
      state.netMoveUnits <= -8 ? "INTERN OF MORTALITY" :
      "MIDDLE MANAGER OF MORTALITY";

    const sign = (end - start) >= 0 ? "+" : "";
    const queueDelta = end - start;

    const report = [
      "DEATH QUEUE‚Ñ¢ ‚Äî ARCADE SUMMARY",
      "--------------------------------",
      `QUEUE CHANGE:  ${sign}${commas(queueDelta)} spots`,
      `NET MOVEMENT:  ${(state.netMoveUnits>=0?"+":"")}${state.netMoveUnits} units`,
      "",
      `BEST ACTION:   ${state.best}`,
      `WORST ACTION:  ${state.worst}`,
      "",
      `TITLE EARNED:  ${title}`,
      "",
      "TIP: SCREENSHOT THIS. IT'S THE WHOLE JOKE."
    ].join("\\n");

    summary.textContent = report;
    modal.classList.add("show");
  }

  function tick(){
    const now = performance.now();
    const dt = (now - state.lastTick) / 1000;
    state.lastTick = now;

    if(!state.running) return;

    let timerRate = 1;
    const frozen = now < state.freezeUntil;
    if(frozen) timerRate = 0;
    if(now < state.slowTimerUntil) timerRate *= 0.5;
    if(now < state.speedAfterIgnoreUntil) timerRate *= 1.35;

    state.timeLeft = clamp(state.timeLeft - dt * timerRate, 0, state.duration);
    timeEl.textContent = fmtTime(state.timeLeft);

    if(state.timeLeft <= 0){
      setStatus("SESSION COMPLETE", "üòê");
      showToast("SESSION COMPLETE  ‚Ä¢  please remain in line", 1600);
      setTimeout(endSession, 350);
    }

    const beltSpeed = 70 * (frozen ? 1.2 : 1.0);
    state.beltPhase = (state.beltPhase + beltSpeed*dt) % 52;
    belt.style.transform = `translateX(${-state.beltPhase}px)`;

    const forwardPull = (frozen ? 28 : 18) * dt;
    state.vel += -forwardPull * 4;

    if(state.pendingSmoke && now >= state.pendingSmokeAt){
      state.pendingSmoke = false;
      resolveSmokePenalty();
    }

    state.vel *= Math.pow(0.76, dt * 60);
    state.pos += state.vel * dt;
    state.pos = clamp(state.pos, -120, 120);
    player.style.transform = `translateX(${state.pos}px)`;

    const driftSpotsPerSec = frozen ? 680 : 520;
    state.queueNow -= driftSpotsPerSec * dt;
    state.queueNow += (state.pos * 0.9) * dt;
    state.queueNow = Math.max(1, Math.floor(state.queueNow));
    queueEl.textContent = `#${commas(state.queueNow)}`;

    const nowS = (now - state.startedAt) / 1000;
    updateCooldownUI(nowS);

    requestAnimationFrame(tick);
  }

  close.addEventListener("click", () => modal.classList.remove("show"));
  retry.addEventListener("click", () => window.location.reload());
  modal.addEventListener("click", (e) => { if(e.target === modal) modal.classList.remove("show"); });

  showToast("WELCOME  ‚Ä¢  you are now in line", 1400);
  updateCooldownUI(0);
  requestAnimationFrame(tick);
})();
</script>
</body>
</html>